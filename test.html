<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Our Digital Scrapbook ‚ù§Ô∏è</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&family=Patrick+Hand&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/Draggable.min.js"></script>

    <style>
        :root {
            --desk-bg: transparent; 
            --paper-bg: #fffbf0;
            --paper-texture: url('https://www.transparenttextures.com/patterns/cream-paper.png');
            --hand-font: 'Patrick Hand', cursive;
            --sans-font: 'Nunito', sans-serif;
            --accent-blue: #5a9cec;
            --dark-blue: #2c3e50;
            --paper-width: 900px;
        }

        * { box-sizing: border-box; }
        
        body {
            margin: 0; padding: 0;
            background: transparent;
            font-family: var(--sans-font);
            overflow-x: hidden;
            min-height: 100vh;
            display: flex; flex-direction: column; align-items: center;
        }

        .home-btn {
            position: fixed; top: 20px; left: 20px; z-index: 10001;
            background: white; color: var(--accent-blue); border: 2px solid var(--accent-blue);
            width: 40px; height: 40px; border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            text-decoration: none; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        .home-btn:hover { transform: scale(1.1); background: var(--accent-blue); color: white; }

        header { 
            text-align: center; padding: 20px 10px; color: var(--dark-blue); 
            width: 100%; max-width: var(--paper-width); z-index: 2;
        }
        h1 { font-family: var(--hand-font); font-size: 2.2rem; margin: 0; }
        p.subtitle { margin-top: 5px; font-size: 0.9rem; opacity: 0.8; }

        #scrapbook-paper {
            position: relative;
            width: 100%;
            max-width: var(--paper-width);
            height: 100vh; 
            background-color: var(--paper-bg);
            background-image: var(--paper-texture);
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            margin-bottom: 50px;
            border-radius: 5px;
            overflow-x: hidden; 
            overflow-y: visible; 
            transition: height 0.3s ease;
        }

        #scrapbook-paper::before {
            content: ''; position: absolute; top: 0; left: 40px; bottom: 0;
            width: 2px; background: rgba(255, 0, 0, 0.1); pointer-events: none; z-index: 0;
        }

        .scrap-item { position: absolute; cursor: grab; touch-action: none; max-width: 90%; }
        .scrap-item:active { cursor: grabbing; }

        .polaroid {
            background: #fff; padding: 10px 10px 35px 10px;
            box-shadow: 2px 4px 12px rgba(0,0,0,0.15); width: 180px;
        }
        .polaroid img { width: 100%; height: auto; pointer-events: none; display: block; background: #eee; }
        .polaroid-caption {
            font-family: var(--hand-font); text-align: center; margin-top: 10px;
            color: #444; font-size: 1.1rem; line-height: 1.2;
        }

        .sticky-note {
            width: 160px; padding: 20px;
            font-family: var(--hand-font); font-size: 1.2rem;
            box-shadow: 2px 4px 10px rgba(0,0,0,0.1); 
            color: #333; text-align: center;
        }
        .note-blue { background: #d4f1f4; color: #2c5f63; }
        .note-yellow { background: #fffde7; color: #555; }
        .note-purple { background: #e0d4f4; color: #4a2c63; }

        .fab-container { position: fixed; bottom: 25px; right: 25px; z-index: 10000; }
        .fab-btn {
            width: 55px; height: 55px; border-radius: 50%;
            background: var(--accent-blue); color: white; border: none;
            box-shadow: 0 5px 20px rgba(90, 156, 236, 0.5);
            font-size: 1.4rem; cursor: pointer; display: flex; justify-content: center; align-items: center;
            transition: transform 0.2s;
        }
        .fab-btn:active { transform: scale(0.9); }

        #admin-panel {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px);
            box-shadow: 0 -5px 30px rgba(0,0,0,0.15);
            padding: 20px; z-index: 9999;
            border-top-left-radius: 20px; border-top-right-radius: 20px;
            transform: translateY(120%); transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
            max-width: 600px; left: 50%;
        }
        #admin-panel.active { transform: translate(-50%, 0); }

        .panel-grid { display: grid; gap: 15px; }
        .panel-group { background: #f8f9fa; padding: 10px; border-radius: 10px; border: 1px solid #eee; }
        .panel-group h4 { margin: 0 0 5px 0; font-size: 0.8rem; color: #777; text-transform: uppercase; }
        input, select { padding: 8px; border: 1px solid #ddd; border-radius: 6px; width: 100%; margin-bottom: 5px; }
        
        .btn-action {
            width: 100%; padding: 10px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; color: white; margin-top: 5px; display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .btn-blue { background: var(--accent-blue); }
        .btn-green { background: #2ecc71; }
        .btn-orange { background: #e67e22; }
        .btn-red { background: #ff7675; }

        #custom-modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 20000;
            display: none; justify-content: center; align-items: center;
            opacity: 0; transition: opacity 0.3s ease;
        }
        #custom-modal-overlay.show { opacity: 1; }
        
        .custom-modal {
            background: #fff; padding: 25px; border-radius: 15px;
            width: 85%; max-width: 350px; text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transform: scale(0.8); transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-family: var(--sans-font);
        }
        #custom-modal-overlay.show .custom-modal { transform: scale(1); }
        
        .modal-icon { font-size: 2rem; color: var(--accent-blue); margin-bottom: 15px; }
        .modal-message { margin-bottom: 20px; color: #444; font-size: 1.05rem; line-height: 1.5; }
        .modal-buttons { display: flex; gap: 10px; justify-content: center; }
        .modal-buttons button { width: auto; padding: 8px 20px; font-size: 0.9rem; }

        @media (max-width: 768px) {
            #scrapbook-paper { 
                width: 90%; 
                margin-top: 10px;
                margin-bottom: 120px; 
            }
            #scrapbook-paper::before { left: 15px; } 
            header { padding: 10px; }
            h1 { font-size: 1.8rem; }
            .polaroid { width: 150px; }
            .sticky-note { width: 140px; }
            
            #admin-panel { width: 100%; max-width: 100%; transform: translateY(120%); left: 0; border-radius: 20px 20px 0 0; }
            #admin-panel.active { transform: translateY(0); }
        }
    </style>
</head>
<body>

    <div class="bg-elements" id="bg-elements"></div>

    <div id="custom-modal-overlay">
        <div class="custom-modal">
            <div class="modal-icon"><i class="fas fa-heart"></i></div>
            <p class="modal-message" id="modal-message">Pesan disini</p>
            <div class="modal-buttons">
                <button id="btn-cancel" class="btn-action btn-red" style="background:#ddd; color:#555; display:none">Batal</button>
                <button id="btn-confirm" class="btn-action btn-blue">OK</button>
            </div>
        </div>
    </div>

    <a href="index.html" class="home-btn"><i class="fas fa-home"></i></a>

    <header>
        <h1>Our Memories üíô</h1>
        <p class="subtitle">Kertas ini akan memanjang seiring kenangan kita.</p>
    </header>

    <div id="scrapbook-paper"></div>

    <div class="fab-container">
        <button class="fab-btn" onclick="togglePanel()"><i class="fas fa-pencil-alt"></i></button>
    </div>

    <div id="admin-panel">
        <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
            <h3 style="margin:0; color:#2c3e50;">Edit Scrapbook</h3>
            <i class="fas fa-times" style="cursor:pointer; padding:5px;" onclick="togglePanel()"></i>
        </div>
        
        <div class="panel-grid">
            <div class="panel-group">
                <h4>üì∏ Tambah Foto</h4>
                <input type="file" id="img-file" accept="image/*">
                <input type="text" id="img-caption" placeholder="Caption...">
                <button class="btn-action btn-blue" onclick="addPhoto()">Tempel Foto</button>
            </div>
            
            <div class="panel-group">
                <h4>üìù Tambah Catatan</h4>
                <input type="text" id="note-text" placeholder="Isi pesan...">
                <select id="note-color">
                    <option value="note-blue">Biru</option>
                    <option value="note-yellow">Kuning</option>
                    <option value="note-purple">Ungu</option>
                </select>
                <button class="btn-action btn-blue" onclick="addNote()">Tempel Note</button>
            </div>
            
            <div class="panel-group">
                <h4>üíæ Backup & Restore</h4>
                <div style="display:flex; gap:10px;">
                    <button class="btn-action btn-green" onclick="downloadKenangan()">
                        <i class="fas fa-download"></i> Simpan
                    </button>
                    <input type="file" id="restore-file" accept=".json" style="display:none" onchange="restoreKenangan(this)">
                    <button class="btn-action btn-orange" onclick="document.getElementById('restore-file').click()">
                        <i class="fas fa-folder-open"></i> Restore
                    </button>
                </div>
            </div>

            <button class="btn-action btn-red" onclick="clearAll()"><i class="fas fa-trash"></i> Reset Canvas</button>
        </div>
    </div>

    <script src="script.js"></script>

    <script>
        gsap.registerPlugin(Draggable);

        const modalOverlay = document.getElementById('custom-modal-overlay');
        const modalMsg = document.getElementById('modal-message');
        const btnConfirm = document.getElementById('btn-confirm');
        const btnCancel = document.getElementById('btn-cancel');
        const modalIcon = document.querySelector('.modal-icon i');

        function openModal() {
            modalOverlay.style.display = 'flex';
            setTimeout(() => { modalOverlay.classList.add('show'); }, 10);
        }

        function closeModal() {
            modalOverlay.classList.remove('show');
            setTimeout(() => { modalOverlay.style.display = 'none'; }, 300);
        }

        function showCustomAlert(msg, iconClass = "fas fa-info-circle") {
            modalMsg.innerText = msg;
            modalIcon.className = iconClass;
            btnCancel.style.display = 'none';
            btnConfirm.innerText = "OK";
            btnConfirm.onclick = closeModal;
            openModal();
        }

        function customConfirm(msg, onYes) {
            modalMsg.innerText = msg;
            modalIcon.className = "fas fa-question-circle";
            btnCancel.style.display = 'block';
            btnConfirm.innerText = "Ya";
            btnCancel.onclick = closeModal;
            btnConfirm.onclick = () => { onYes(); closeModal(); };
            openModal();
        }

        function togglePanel() {
            const panel = document.getElementById('admin-panel');
            const icon = document.querySelector('.fab-btn i');
            panel.classList.toggle('active');
            icon.className = panel.classList.contains('active') ? 'fas fa-chevron-down' : 'fas fa-pencil-alt';
        }

        const savedConfig = []; 
        let items = [];
        const paper = document.getElementById('scrapbook-paper');

        function init() {
            const localData = localStorage.getItem('scrapbookData');
            items = localData ? JSON.parse(localData) : savedConfig;
            renderItems();
            setTimeout(checkResponsiveBounds, 100);
        }

        function checkResponsiveBounds() {
            const paperWidth = paper.offsetWidth;
            let hasChanges = false;

            items.forEach((item, index) => {
                const el = document.querySelector(`.scrap-item[data-index="${index}"]`);
                if (!el) return;

                const itemWidth = el.offsetWidth || 180; 
                const maxAllowedX = paperWidth - itemWidth;

                if (item.x > maxAllowedX) {
                    item.x = Math.max(0, maxAllowedX); 
                    gsap.to(el, { x: item.x, duration: 0.5, ease: "power2.out" });
                    hasChanges = true;
                }
            });

            if (hasChanges) {
                saveToLocal();
                adjustPaperHeight();
            }
        }

        let resizeTimer;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(() => {
                checkResponsiveBounds();
                adjustPaperHeight();
            }, 300);
        });

        function downloadKenangan() {
            if(items.length === 0) return showCustomAlert("Belum ada kenangan yang dibuat!", "fas fa-exclamation-triangle");
            
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(items, null, 2));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "kenangan_kita.json");
            document.body.appendChild(downloadAnchorNode); 
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        }

        function restoreKenangan(inputElement) {
            const file = inputElement.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (Array.isArray(data)) {
                        customConfirm("Ini akan menimpa kenangan yang ada di layar sekarang. Lanjut?", function() {
                            items = data;
                            saveToLocal();
                            renderItems();
                            setTimeout(checkResponsiveBounds, 100);
                            togglePanel();
                            showCustomAlert("Kenangan berhasil dikembalikan! üíô", "fas fa-check-circle");
                        });
                    } else {
                        showCustomAlert("File tidak valid! Pastikan pilih file .json yang benar.", "fas fa-times-circle");
                    }
                } catch (error) {
                    showCustomAlert("Gagal membaca file kenangan. " + error, "fas fa-times-circle");
                }
                inputElement.value = '';
            };
            reader.readAsText(file);
        }

        function adjustPaperHeight() {
            let maxY = 0;
            items.forEach(item => {
                const itemBottom = item.y + 350; 
                if (itemBottom > maxY) maxY = itemBottom;
            });
            const minHeight = window.innerHeight;
            const newHeight = Math.max(minHeight, maxY + 200);
            paper.style.height = newHeight + 'px';
        }

        function renderItems() {
            paper.innerHTML = ''; 
            items.forEach((item, index) => {
                const el = document.createElement('div');
                el.classList.add('scrap-item');
                el.dataset.index = index;
                gsap.set(el, { x: item.x, y: item.y, rotation: item.r });

                if (item.type === 'polaroid') {
                    el.classList.add('polaroid');
                    el.innerHTML = `<img src="${item.src}"><div class="polaroid-caption">${item.text}</div>`;
                } else if (item.type === 'note') {
                    el.classList.add('sticky-note', item.color);
                    el.innerText = item.text;
                }

                el.addEventListener('dblclick', () => deleteItem(index));

                let lastTap = 0;
                el.addEventListener('touchend', (e) => {
                    const currentTime = new Date().getTime();
                    const tapLength = currentTime - lastTap;
                    if (tapLength < 300 && tapLength > 0) {
                        e.preventDefault(); 
                        deleteItem(index);  
                    }
                    lastTap = currentTime;
                });

                el.addEventListener('touchstart', () => bringToFront(el), {passive: true});
                el.addEventListener('mousedown', () => bringToFront(el));
                paper.appendChild(el);
            });
            makeDraggable();
            adjustPaperHeight(); 
        }

        function bringToFront(el) {
            gsap.to(el, { zIndex: 100, scale: 1.05, duration: 0.2, boxShadow: "5px 15px 30px rgba(0,0,0,0.2)" });
        }

        function makeDraggable() {
            Draggable.create(".scrap-item", {
                type: "x,y",
                inertia: true,
                edgeResistance: 0.85, 
                onPress: function() { 
                    this.target.classList.add("dragging"); 
                    bringToFront(this.target); 
                    this.maxX = paper.offsetWidth - this.target.offsetWidth;
                },
                liveSnap: {
                    x: function(value) {
                        return Math.max(0, Math.min(value, this.maxX)); 
                    },
                    y: function(value) {
                        return Math.max(0, value);
                    }
                },
                onDrag: function() {
                    const currentBottom = this.y + this.target.offsetHeight + 150;
                    if (currentBottom > paper.offsetHeight) {
                        paper.style.height = currentBottom + "px";
                    }
                },
                onRelease: function() { 
                    this.target.classList.remove("dragging");
                    gsap.to(this.target, { scale: 1, zIndex: 1, duration: 0.2, boxShadow: "2px 4px 12px rgba(0,0,0,0.15)" });
                    updatePosition(this.target, this.x, this.y);
                },
                onDragEnd: function() {
                    updatePosition(this.target, this.x, this.y);
                }
            });
        }

        function updatePosition(el, x, y) {
            const idx = el.dataset.index;
            if (items[idx]) {
                items[idx].x = x; items[idx].y = y;
                items[idx].r = gsap.getProperty(el, "rotation");
                saveToLocal();
                adjustPaperHeight(); 
            }
        }

        function getSafePosition() {
            const maxX = paper.offsetWidth - 200; 
            let x = Math.random() * maxX; if(x<20) x=20;
            let maxY = 0;
            items.forEach(item => { if (item.y > maxY) maxY = item.y; });
            let y = items.length > 0 ? maxY + 250 : 50;
            return { x, y, r: (Math.random() * 10) - 5 };
        }

        function addPhoto() {
            const fileInput = document.getElementById('img-file');
            const caption = document.getElementById('img-caption').value;
            const file = fileInput.files[0];
            if (!file) return showCustomAlert("Pilih foto dulu!", "fas fa-camera");
            if(file.size > 2 * 1024 * 1024) return showCustomAlert("File max 2MB", "fas fa-file-excel");

            const reader = new FileReader();
            reader.onload = function(e) {
                const pos = getSafePosition();
                items.push({ type: 'polaroid', src: e.target.result, text: caption, x: pos.x, y: pos.y, r: pos.r });
                saveToLocal(); renderItems(); togglePanel();
                fileInput.value = ''; document.getElementById('img-caption').value = '';
                setTimeout(checkResponsiveBounds, 50);
                window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
            };
            reader.readAsDataURL(file);
        }

        function addNote() {
            const text = document.getElementById('note-text').value;
            const color = document.getElementById('note-color').value;
            if(!text) return showCustomAlert("Isi notenya dulu!", "fas fa-pen");
            const pos = getSafePosition();
            items.push({ type: 'note', text: text, color: color, x: pos.x, y: pos.y, r: pos.r });
            saveToLocal(); renderItems(); togglePanel();
            document.getElementById('note-text').value = '';
            setTimeout(checkResponsiveBounds, 50);
            window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
        }

        function deleteItem(index) {
            customConfirm("Hapus item ini?", function() {
                items.splice(index, 1);
                saveToLocal();
                renderItems();
            });
        }

        function clearAll() {
            customConfirm("Yakin hapus semua kenangan?", function() {
                items = [];
                saveToLocal();
                renderItems();
                togglePanel();
            });
        }

        function saveToLocal() { localStorage.setItem('scrapbookData', JSON.stringify(items)); }

        window.onload = init;
    </script>
</body>
</html>